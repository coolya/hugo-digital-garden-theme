{{ define "main" }}

<div class="container">
    <article>
        <div class="row justify-content-center">
            <div class="col-lg-8">
                
                <!-- Header -->
                <header class="mb-4">
                    <h1 class="display-4 mb-3">{{ .Title }}</h1>
                    
                    <!-- Metadata -->
                    <div class="mb-3 text-muted">
                        <small>
                            Published {{ .Date.Format "January 2, 2006" }}
                            {{ if ne .Date .Lastmod }}
                            • Updated {{ .Lastmod.Format "January 2, 2006" }}
                            {{ end }}
                        </small>
                        {{ partial "status.html" . }}
                    </div>
                    
                    <!-- Tags -->
                    {{ with .Params.writing_tags }}
                    <div class="mb-3">
                        {{ range . }}
                        <span class="badge bg-secondary me-1">{{ . }}</span>
                        {{ end }}
                    </div>
                    {{ end }}
                </header>

                <!-- Content -->
                <div class="content serif fs-5 lh-base">
                    {{ .Content }}
                </div>

                <!-- Backlinks Section -->
                {{ $currentPage := . }}
                {{ $backlinks := slice }}
                {{ range .Site.AllPages }}
                    {{ if and (ne . $currentPage) (in .Content $currentPage.Title) }}
                        {{ $backlinks = $backlinks | append . }}
                    {{ end }}
                {{ end }}
                
                {{ if $backlinks }}
                <div class="mt-5 pt-4 border-top">
                    <h3>Referenced by</h3>
                    <ul class="list-unstyled">
                        {{ range $backlinks }}
                        <li class="mb-2">
                            <a href="{{ .Permalink }}" class="text-decoration-none">
                                <strong>{{ .Title }}</strong>
                            </a>
                            <small class="text-muted d-block">{{ .Section | title }} • {{ .Date.Format "Jan 2, 2006" }}</small>
                        </li>
                        {{ end }}
                    </ul>
                </div>
                {{ end }}

            </div>
        </div>
    </article>
</div>

{{ end }}
